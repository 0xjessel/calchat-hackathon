<!DOCTYPE html>
<html lang="en">
<head>
<title>nowjs test</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/nowjs/now.js"></script>
<script type="text/javascript" src="http://www.calchat.jessechen.net/js/fb.js"/></script>

</head>

<body>
		<div class="navbar">
			<div class="navbar-inner">
				<div class="container">
		
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
		  
					<a class="brand" href="#">calchat</a>
		  
					<div class="nav-collapse">
						<ul class="nav">
							<li><a href="#" id="what" rel="popover" data-original-title="we're calchat" data-content="here is what we do.  wiggle wiggle wiggle">What?</a></li>
							<li><a href="#">About</a></li>
						</ul>
						<ul class="nav pull-right">
							<li>
								<div id="login"><button class="btn" onClick="loginUser();">Login</button></div>
								<div id="user-info" data-toggle="dropdown"></div>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
<div id="fb-root"></div>
<script>
	window.fbAsyncInit = function() {
		FB.init({ appId: '297402036983700', 
			status: true, 
			cookie: true,
			xfbml: true,
			auth: true});

		FB.Event.subscribe('auth.authResponseChange', handleResponseChange);  
				
		FB.getLoginStatus(function(response) {
			if (response.status === 'connected') {
				FB.api('/me', function(response) {
					now.name = response.name;
					(elem = document.getElementById('login')).parentNode.removeChild(elem);
				       document.getElementById('user-info').innerHTML = '<img id="profile-picture" src="https://graph.facebook.com/' + response.id + '/picture">' + ' ' + response.name;
				});
			} else {
				console.log(response.status);
			}
		});
	};
	
  (function() {
    var e = document.createElement('script'); e.async = true;
        e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
        document.getElementById('fb-root').appendChild(e);
        }());
	
</script>
<div>
<div id="login"><button class="btn" onClick="loginUser();">Login</button></div>
  <a href="#" class="change selected">room 1</a> -
  <a href="#" class="change">room 2</a> -
  <a href="#" class="change">room 3</a>
</div>
<br>
<div id="messages"><br>You're in room 1</div>
<input type="text" id="text-input">
<input type="button" value="Send" id="send-button">

<script>
$(document).ready(function(){
				
  now.receiveMessage = function(name,  message){
    $("#messages").append("<br>" + name + ": " + message);
  }
  
  document.getElementById("brand").innerHTML="calchat/"+now.room;
  
  $("#send-button").click(function(){
    now.distributeMessage($("#text-input").val());
    $("#text-input").val("");
  });

  $(".change").click(function(){
    now.changeRoom($(this).text());
  });

});
</script>
</body>
</html>
